## ArgoCD Helm Chart Values
## Reference: https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd

global:
  domain: argocd.dthackray.com

server:
  extraArgs:
    - --insecure  # TLS termination happens at Traefik

  # Ingress configuration
  ingress:
    enabled: true
    ingressClassName: traefik
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      # Enable Authentik ForwardAuth middleware
      traefik.ingress.kubernetes.io/router.middlewares: default-authentik@kubernetescrd
    hostname: argocd.dthackray.com
    tls: true
    extraTls:
      - hosts:
          - argocd.dthackray.com
        secretName: argocd-tls

configs:
  params:
    server.insecure: true  # TLS termination happens at Traefik

  cm:
    # Disable user management - Authentik handles auth
    users.anonymous.enabled: "true"
    admin.enabled: "false"

  # Disable ArgoCD authentication - using Authentik instead
  # All users who reach ArgoCD through Authentik get admin access
  rbac:
    policy.default: role:admin
    policy.csv: |
      g, system:anonymous, role:admin

# Disable Dex (built-in auth provider) - using Authentik instead
dex:
  enabled: false
