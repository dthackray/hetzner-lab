# Loki Configuration for hetzner-lab cluster
# Single-binary mode for homelab use

# Deploy mode - single binary is simpler for homelab
deploymentMode: SingleBinary

loki:
  # Authentication disabled - using Authentik at ingress level
  auth_enabled: false

  # Common config
  commonConfig:
    replication_factor: 1

  # Schema config
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h

  # Storage config - filesystem for homelab (no S3 needed)
  storage:
    type: filesystem

  # Limits config
  limits_config:
    retention_period: 30d
    ingestion_rate_mb: 10
    ingestion_burst_size_mb: 20
    max_streams_per_user: 10000
    max_global_streams_per_user: 10000

# Single binary configuration
singleBinary:
  replicas: 1

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  persistence:
    enabled: true
    size: 20Gi

# Disable components not needed in single-binary mode
backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0

# Gateway configuration
gateway:
  enabled: true
  replicas: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

# Disable chunksCache, resultsCache for simplicity
chunksCache:
  enabled: false
resultsCache:
  enabled: false

# Monitoring - expose ServiceMonitor for Prometheus
monitoring:
  serviceMonitor:
    enabled: true
    labels:
      release: kube-prometheus-stack

  # Self-monitoring dashboards
  dashboards:
    enabled: true
    labels:
      grafana_dashboard: "1"

  # Recording rules for Prometheus
  rules:
    enabled: true
    labels:
      release: kube-prometheus-stack

# Test disabled
test:
  enabled: false
